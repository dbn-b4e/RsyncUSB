#!/bin/bash

# Find external volumes (exclude system volumes)
VOLUMES=$(ls /Volumes/ | grep -v "Macintosh HD" | grep -v "com.apple" | grep -v "Sauvegardes")

if [ -z "$VOLUMES" ]; then
    echo "No external disks found!"
    exit 1
fi

echo "Available external disks:"
echo ""
i=1
declare -a DISK_ARRAY
while IFS= read -r disk; do
    DISK_ARRAY[$i]="$disk"
    echo "  $i) $disk"
    ((i++))
done <<< "$VOLUMES"

echo ""
read -p "Select disk number [1]: " choice
choice=${choice:-1}

SELECTED="${DISK_ARRAY[$choice]}"

if [ -z "$SELECTED" ]; then
    echo "Invalid selection!"
    exit 1
fi

echo ""
echo "Syncing ~/Work to /Volumes/$SELECTED/Work ..."
echo ""

/usr/local/bin/rsync -avh --info=progress2 \
    --exclude='.SynologyWorkingDirectory' \
    --exclude='@eaDir' \
    --exclude='.DS_Store' \
    ~/Work "/Volumes/$SELECTED"
